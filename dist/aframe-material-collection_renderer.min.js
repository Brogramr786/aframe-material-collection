!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=36)}({11:function(e,t){e.exports=AFRAME.registerPrimitive("a-ui-renderer",AFRAME.utils.extendDeep({},AFRAME.primitives.getMeshMixin(),{defaultComponents:{"ui-renderer":{}},mappings:{"ui-panel":"ui-renderer.uiPanel","look-controls-el":"ui-renderer.lookControlsEl","look-controls-component":"ui-renderer.lookControlsComponent","panel-position":"ui-renderer.panelPosition","panel-size":"ui-renderer.panelSize","render-resolution":"ui-renderer.renderResolution","debug-raycaster":"ui-renderer.debugRaycaster",fps:"ui-renderer.fps","intersectable-class":"ui-renderer.intersectableClass"}}))},19:function(e,t){e.exports=AFRAME.registerComponent("ui-renderer",{schema:{uiPanel:{type:"selector"},lookControlsEl:{type:"selector"},lookControlsComponent:{default:"look-controls"},panelPosition:{type:"vec3",default:{x:0,y:1.6,z:-1}},panelSize:{type:"vec2",default:{x:6,y:3}},renderResolution:{type:"vec2",default:{x:2048,y:1024}},debugRaycaster:{type:"boolean",default:!1},fps:{type:"number",default:45},intersectableClass:{default:"intersectable"}},init(){this.el.components["ui-renderer"].isInit||(this.setupBackDrop(),this.data.uiPanel?this.meshEl=this.data.uiPanel:this.meshEl=this.setupUIPanel(),this.el.object3D.parent.remove(this.el.object3D),this.camera=new THREE.PerspectiveCamera(100,2,.1,1e3),this.renderTarget=new THREE.WebGLRenderTarget(this.data.renderResolution.x,this.data.renderResolution.y,{antialias:!0}),this.meshEl.getObject3D("mesh").material.map=this.renderTarget.texture,this.isRendering=!0,this.stoppedRendering=!1,this.el.sceneEl.addEventListener("ui-changing",()=>{this.stoppedRendering=!1,this.isRendering=!0}),this.el.sceneEl.addEventListener("ui-changing-stopped",()=>{this.isRendering=!1}),this.raycaster=new THREE.Raycaster,this.helper=new THREE.Mesh(new THREE.SphereGeometry(.01),new THREE.MeshBasicMaterial({color:"#ff0000"})),this.data.debugRaycaster&&this.el.object3D.add(this.helper),this.lastRenderTime=0,this.isFrozen=!1,this.isInit=!0)},pauseRender(){return this.playRender(!0)},playRender(e){let t=this;return new Promise(s=>{if(t.isFrozen===e||t.isAnimatingBackground)return s();t.isAnimatingBackground=!0,t.isFrozen||this.backdrop.setAttribute("scale","1 1 1");let i=t.isFrozen?.9:1e-6,n=t.isFrozen?1e-6:.9,r=t.isFrozen?350:500;t.isFrozen&&(t.isFrozen=e,t.play()),UI.utils.isChanging(t.el.sceneEl,t.backdrop.uuid),new TWEEN.Tween({x:i}).to({x:n},r).onUpdate(function(){t.backdrop.setAttribute("opacity",this.x)}).onComplete(()=>{t.isFrozen=e,t.isAnimatingBackground=!1,UI.utils.stoppedChanging(this.backdrop.uuid),t.isFrozen?t.pause():this.backdrop.setAttribute("scale","0.000001 0.000001 0.000001"),s()}).easing(TWEEN.Easing.Exponential.Out).start()})},setupBackDrop(){this.backdrop=document.createElement("a-plane"),this.backdrop.setAttribute("transparent",!0),this.backdrop.setAttribute("opacity",1e-6),this.backdrop.setAttribute("color","#000"),this.backdrop.setAttribute("shader","flat"),this.backdrop.setAttribute("position",{x:0,y:0,z:-.2}),this.backdrop.setAttribute("width",1),this.backdrop.setAttribute("height",1),this.backdrop.setAttribute("scale","0.000001 0.000001 0.000001"),this.el.appendChild(this.backdrop)},play(){this.lastMouseMoveTime=0,this.click=(e=>this.mouseEvent("click",this.lastMoveEvent||e)),this.mousedown=(e=>this.mouseEvent("mousedown",this.lastMoveEvent||e)),this.mouseup=(e=>this.mouseEvent("mouseup",this.lastMoveEvent||e)),this.mousewheel=(e=>this.mouseEvent("ui-mousewheel",e.detail.evt)),this.mousemove=(e=>{this.lastMoveEvent=e,this.mouseEvent("ui-mousemove",e)}),this.meshEl.addEventListener("mousedown",this.mousedown),this.meshEl.addEventListener("mouseup",this.mouseup),this.meshEl.addEventListener("click",this.click),this.meshEl.addEventListener("ui-mousemove",this.mousemove),this.meshEl.addEventListener("ui-mousewheel",this.mousewheel)},pause(){this.meshEl.removeEventListener("mousedown",this.mousedown),this.meshEl.removeEventListener("mouseup",this.mouseup),this.meshEl.removeEventListener("click",this.click),this.meshEl.removeEventListener("ui-mousemove",this.mousemove),this.meshEl.removeEventListener("ui-mousewheel",this.mousewheel)},setupUIPanel(){let e=document.createElement("a-plane");return e.setAttribute("position",this.data.panelPosition),e.setAttribute("width",this.data.panelSize.x),e.setAttribute("height",this.data.panelSize.y),this.el.sceneEl.appendChild(e),e},mouseEvent(e,t){let s={x:0,y:0};if(t.detail.intersection){let e=this.el.object3D.worldToLocal(t.detail.intersection.point);s={x:e.x/this.meshEl.getAttribute("width")*2,y:e.y/this.meshEl.getAttribute("height")*2}}"ui-mousewheel"===e&&t.detail.evt&&(s.deltaY=t.detail.deltaY,s.deltaX=t.detail.deltaX),"mousedown"===e&&this.lookControlsEl&&this.lookControlsEl.components["look-controls"]&&this.lookControlsEl.components[this.data.lookControlsComponent].pause(),"mouseup"===e&&this.lookControlsEl&&this.lookControlsEl.components["look-controls"]&&this.lookControlsEl.components[this.data.lookControlsComponent].play(),this.raycastIntersections(t,s,e)},raycastIntersections(e,t,s){if(!this.camera)return;this.raycaster.setFromCamera(t,this.camera);let i=this.raycaster.intersectObjects(this.el.object3D.children,!0);this.prevIntersectionEls=this.prevIntersectionEls||[];let n=[];if(i.length&&this.data.debugRaycaster){let e=i[0].point;i[0].object===this.helper&&i.length>1&&(e=i[1].point),this.helper.position.copy(e),this.helper.position.x-=.03}let r=!1;for(let t=0;t<i.length;t++){let o=i[t];if(o.object.el&&o.object.el.classList.contains(this.data.intersectableClass)){let t={intersection:o,evt:e,preventDefault:()=>{r=!0}};-1!==this.prevIntersectionEls.indexOf(o.object.el)||r||o.object.el.emit("mouseenter",t),r||o.object.el.emit(s,t),o.object.el.intersection=o,n.push(o.object.el)}}for(let e=0;e<this.prevIntersectionEls.length;e++){let t=this.prevIntersectionEls[e];-1===n.indexOf(t)&&t.emit("mouseleave",{intersection:t.intersection})}this.prevIntersectionEls=n},tick(){if(this.isFrozen)return;if((new Date).getTime()-this.lastRenderTime<1e3/this.data.fps&&this.isRendering)return;if(this.stoppedRendering)return;this.el.object3D.traverse(e=>{e.updateMatrixWorld()});let e=this.el.sceneEl.renderer,t=e.vr.enabled;e.vr.enabled=!1,e.render(this.el.object3D,this.camera,this.renderTarget),e.vr.enabled=t,this.lastRenderTime=(new Date).getTime(),this.isRendering||(this.stoppedRendering=!0)}})},36:function(e,t,s){"use strict";s.r(t);s(19),s(11)}});